# Railway 部署可视化流程

```
┌─────────────────────────────────────────────────────────────────┐
│                    Railway 部署完整流程                          │
└─────────────────────────────────────────────────────────────────┘

┌──────────────┐
│  准备阶段     │
└──────────────┘
       │
       ├─→ ✅ 代码推送到GitHub
       ├─→ ✅ 检查配置文件(railway.json, nixpacks.toml)
       └─→ ✅ 准备环境变量模板
       
       ↓

┌──────────────┐
│ Railway登录   │
└──────────────┘
       │
       ├─→ 访问 https://railway.app
       ├─→ 使用GitHub账号登录
       └─→ 授权访问仓库权限
       
       ↓

┌──────────────┐
│ 创建项目      │
└──────────────┘
       │
       ├─→ 点击 "New Project"
       ├─→ 选择 "Deploy from GitHub repo"
       └─→ 选择 chenglu1/nestAdmin
       
       ↓

┌─────────────────────────────────────────────────────────────────┐
│                      服务部署三步走                              │
└─────────────────────────────────────────────────────────────────┘

┌──────────────┐     ┌──────────────┐     ┌──────────────┐
│  Step 1       │     │  Step 2      │     │  Step 3      │
│  部署MySQL    │────→│  部署后端    │────→│  部署前端    │
└──────────────┘     └──────────────┘     └──────────────┘
       │                    │                    │
       │                    │                    │
       ↓                    ↓                    ↓

┌──────────────┐     ┌──────────────┐     ┌──────────────┐
│ 数据库服务    │     │ NestJS后端   │     │ React前端    │
├──────────────┤     ├──────────────┤     ├──────────────┤
│ + New        │     │ + New        │     │ + New        │
│ → Database   │     │ → GitHub Repo│     │ → GitHub Repo│
│ → MySQL      │     │ → backend/   │     │ → frontend/  │
├──────────────┤     ├──────────────┤     ├──────────────┤
│ 自动配置:     │     │ 配置变量:     │     │ 配置变量:     │
│ • MYSQLHOST  │     │ • DB_HOST    │     │ • VITE_API_  │
│ • MYSQLPORT  │     │ • DB_PASSWORD│     │   URL        │
│ • MYSQLUSER  │     │ • JWT_SECRET │     │ • PORT=3000  │
│ • MYSQLPASS  │     │ • PORT=3001  │     │              │
│ • MYSQLDATAB │     │ • CORS_ORIGIN│     │              │
├──────────────┤     ├──────────────┤     ├──────────────┤
│ ⏱ 等待1分钟  │     │ ⏱ 构建3-5分钟│     │ ⏱ 构建2-3分钟│
└──────────────┘     └──────────────┘     └──────────────┘
       │                    │                    │
       ↓                    ↓                    ↓
       
    完成 ✅            获取域名 ✅          获取域名 ✅


┌─────────────────────────────────────────────────────────────────┐
│                      配置关联                                    │
└─────────────────────────────────────────────────────────────────┘

    ┌────────────┐
    │   MySQL    │
    └─────┬──────┘
          │
          │ ${{MySQL.MYSQLHOST}}
          ↓
    ┌────────────┐       VITE_API_URL        ┌────────────┐
    │  Backend   │←───────────────────────────│  Frontend  │
    │  后端服务   │                            │  前端服务   │
    └────────────┘                            └────────────┘
          │
          │ CORS_ORIGIN
          └──────────────────────────→ Frontend Domain


┌─────────────────────────────────────────────────────────────────┐
│                      初始化数据                                  │
└─────────────────────────────────────────────────────────────────┘

    ┌────────────┐
    │   MySQL    │
    └─────┬──────┘
          │
          ├─→ 点击 "Data" 标签
          ├─→ 点击 "Query" 
          ├─→ 复制 backend/sql/init_data.sql
          ├─→ 执行SQL
          └─→ 验证数据导入 ✅


┌─────────────────────────────────────────────────────────────────┐
│                      最终架构                                    │
└─────────────────────────────────────────────────────────────────┘

        Internet
           │
           │ HTTPS
           ↓
    ┌─────────────────┐
    │  Railway CDN    │
    └────────┬────────┘
             │
        ┌────┴────┐
        │         │
        ↓         ↓
┌──────────┐  ┌──────────┐
│ Frontend │  │ Backend  │
│  React   │  │  NestJS  │
│ :3000    │  │  :3001   │
└──────────┘  └─────┬────┘
                    │
                    ↓
              ┌──────────┐
              │  MySQL   │
              │  :3306   │
              └──────────┘


┌─────────────────────────────────────────────────────────────────┐
│                      访问测试                                    │
└─────────────────────────────────────────────────────────────────┘

1. 访问前端: https://your-frontend.railway.app
   ├─→ 登录页面显示 ✅
   ├─→ 输入: admin / admin123
   └─→ 进入控制台 ✅

2. 访问后端: https://your-backend.railway.app/health
   └─→ 返回: {"status":"ok"} ✅

3. 测试功能:
   ├─→ 用户管理 ✅
   ├─→ 角色管理 ✅
   ├─→ 菜单管理 ✅
   ├─→ 操作日志 ✅
   └─→ 性能监控 ✅


┌─────────────────────────────────────────────────────────────────┐
│                      部署完成!                                   │
└─────────────────────────────────────────────────────────────────┘

总耗时: 约 10-15 分钟
费用: 免费($5额度/月)
可用性: 24/7在线
域名: Railway自动生成HTTPS域名


┌─────────────────────────────────────────────────────────────────┐
│                      故障排查流程                                │
└─────────────────────────────────────────────────────────────────┘

遇到问题?
   │
   ├─→ 构建失败?
   │   ├─→ 查看 Deployments → Build Logs
   │   ├─→ 检查 package.json scripts
   │   └─→ 确认 Node 版本 (18.x)
   │
   ├─→ 数据库连接失败?
   │   ├─→ 检查 MySQL 服务状态
   │   ├─→ 验证环境变量引用格式
   │   └─→ 查看后端日志
   │
   ├─→ CORS错误?
   │   ├─→ 确认 CORS_ORIGIN 配置
   │   ├─→ 检查前端 VITE_API_URL
   │   └─→ 重新部署后端
   │
   └─→ 前端无法连接后端?
       ├─→ 测试后端 /health 接口
       ├─→ 检查浏览器控制台
       └─→ 验证环境变量


┌─────────────────────────────────────────────────────────────────┐
│                   🎉 部署成功检查项                              │
└─────────────────────────────────────────────────────────────────┘

✅ 前端可访问
✅ 后端健康检查通过
✅ 数据库数据导入完成
✅ 用户登录功能正常
✅ 所有功能模块可用
✅ HTTPS证书自动配置
✅ 域名解析正常
✅ Railway项目状态正常

```

## 快速命令参考

```powershell
# 查看部署状态
railway status

# 查看日志
railway logs

# 打开项目控制台
railway open

# 重新部署
railway up --detach

# 查看环境变量
railway variables

# 链接到本地
railway link
```

## 环境变量快速复制

### 后端环境变量
```env
DB_HOST=${{MySQL.MYSQLHOST}}
DB_PORT=${{MySQL.MYSQLPORT}}
DB_USERNAME=${{MySQL.MYSQLUSER}}
DB_PASSWORD=${{MySQL.MYSQL_ROOT_PASSWORD}}
DB_DATABASE=${{MySQL.MYSQLDATABASE}}
JWT_SECRET=your-super-secret-jwt-key-2024
JWT_EXPIRES_IN=7d
PORT=3001
NODE_ENV=production
CORS_ORIGIN=*
```

### 前端环境变量
```env
VITE_API_URL=https://your-backend-domain.railway.app
PORT=3000
NODE_ENV=production
```

## 时间估算

| 步骤 | 预计时间 |
|------|---------|
| 账号注册登录 | 2分钟 |
| 创建项目 | 1分钟 |
| 部署MySQL | 1分钟 |
| 配置并部署后端 | 5分钟 |
| 初始化数据库 | 2分钟 |
| 配置并部署前端 | 4分钟 |
| 测试验证 | 3分钟 |
| **总计** | **~18分钟** |

## 费用估算

```
免费额度: $5/月

你的项目消耗:
├─ Backend (0.5GB RAM): $2/月
├─ Frontend (0.25GB RAM): $1/月
└─ MySQL (0.5GB RAM): $1/月
────────────────────────────────
总计: ~$4/月 ✅ 在免费额度内
```
